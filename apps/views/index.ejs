<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Cảnh báo cháy</title>
    <link rel="icon" href="/static/images/logo.jpg" type="image/x-icon">
    <link href="/public/css/main.css" rel="stylesheet">
    <link href="/static/theme/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>
    <link href="/static/theme/css/agency.min.css" rel="stylesheet">

    <script type="text/javascript">
      function time() {
          var today = new Date();
          var weekday = new Array(7);
          weekday[0] = "Chủ nhật";
          weekday[1] = "Thứ 2";
          weekday[2] = "Thứ 3";
          weekday[3] = "Thứ 4";
          weekday[4] = "Thứ 5";
          weekday[5] = "Thứ 6";
          weekday[6] = "Thứ 7";
          var day = weekday[today.getDay()];
          var dd = today.getDate();
          var mm = today.getMonth() + 1; //January is 0!
          var yyyy = today.getFullYear();
          var h = today.getHours();
          var m = today.getMinutes();
          var s = today.getSeconds();
          m = checkTime(m);
          s = checkTime(s);
          nowTime = h + ":" + m + ":" + s;
          if (dd < 10) {
              dd = '0' + dd
          }
          if (mm < 10) {
              mm = '0' + mm
          }
          today = day + ', ' + dd + '/' + mm + '/' + yyyy;

          tmp = '<span class="date">' + today + ' | ' + nowTime + '</span>';

          document.getElementById("clock").innerHTML = tmp;

          clocktime = setTimeout("time()", "1000", "JavaScript");
          function checkTime(i) {
              if (i < 10) {
                  i = "0" + i;
              }
              return i;
          }
      }
    </script>
  </head>

  <body id="page-top">

    <!-- Menu -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
      <div class="container">
        <a class="navbar-brand js-scroll-trigger" href="#page-top" style="font-family: 'Helvetica Neue',Helvetica,Arial,cursive">Hệ thống giám sát, cảnh báo cháy</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
          <i class="fa fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
          <ul class="navbar-nav text-uppercase ml-auto">
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#tinhtrang">Tình trạng</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#bieudo">Biểu đồ</a>
            </li>
            <li class="nav-item">
              <a class="nav-link js-scroll-trigger" href="#about">Liên hệ</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Phần hiển thị ban đầu -->
    <header class="masthead">
      <div class="container">
          <div id="clock"></div>
        <div class="intro-text"  id="tinhtrang">
          <div class="intro-heading text-uppercase">Thông số môi trường</div>
          <div class="intro-lead-in" id = "thongso">
              <strong>
                  <div style="font-size: 50px; padding-bottom: 50px;">
                    Nhiệt độ: <span id="kqnd"></span> ºC <br>
                  </div>
                      <p>Độ ẩm: <span id="kqda"> </span>% &nbsp;&nbsp;&nbsp;&nbsp;
                         GAS: <span id="kh"></span> ppm</p><br>
                  <p>CO: <span id="CO"></span> ppm  &nbsp;&nbsp;&nbsp;&nbsp;
                     Khói: <span id="khoi"></span> ppm</p>
                  <br><br>
                  <p>Tình trạng: </p><span><div id="tita"></div></span>
               </strong>
          </div>
          <a class="btn btn-primary btn-xl text-uppercase js-scroll-trigger" href="#bieudo">Chi tiết</a>
        </div>
      </div>
    </header>

    <!-- Phần biểu đồ -->
    <section id="bieudo">
        <div>
          <center>
              <p style="font-family: 'Helvetica Neue',Helvetica,Arial,cursive;font-size: 50px;color: green;">Biểu đồ hiển thị thông số môi trường</p>
              <iframe width="450" height="260" style="border: 1px solid #cccccc;"
              src="https://thingspeak.com/channels/478199/charts/1?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=Nhi%E1%BB%87t+%C4%91%E1%BB%99&type=line&xaxis=Th%E1%BB%9Di+gian&yaxis=Nhi%E1%BB%87t+%C4%91%E1%BB%99+%28%2AC%29">
            </iframe>
		        <iframe width="450" height="260" style="border: 1px solid #cccccc;"
              src="https://thingspeak.com/channels/478199/charts/2?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=%C4%90%E1%BB%99+%E1%BA%A9m+m%C3%B4i+tr%C6%B0%E1%BB%9Dng&type=line&xaxis=Th%E1%BB%9Di+gian&yaxis=%C4%90%E1%BB%99+%E1%BA%A9m+%28%25%29&yaxismax=100">
            </iframe>
		      <br></br>
		        <iframe width="450" height="260" style="border: 1px solid #cccccc;"
              src="https://thingspeak.com/channels/478199/charts/3?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=N%E1%BB%93ng+%C4%91%E1%BB%99+Gas+&type=line&xaxis=Th%E1%BB%9Di+gian&yaxis=N%E1%BB%93ng+%C4%91%E1%BB%99+">
            </iframe>
		        <iframe width="450" height="260" style="border: 1px solid #cccccc;"
              src="https://thingspeak.com/channels/478199/charts/4?bgcolor=%23ffffff&color=%23d62020&dynamic=true&results=60&title=N%E1%BB%93ng+%C4%91%E1%BB%99+CO+&type=line&xaxis=Th%E1%BB%9Di+gian&yaxis=N%E1%BB%93ng+%C4%91%E1%BB%99">
            </iframe>
          </center>
        </div>
    </section>

    <!-- Thông tin liên hệ -->
    <section id="about">
      <div class="container">
        <div class="row">
          <div class="col-lg-12 text-center">
            <h2 class="section-heading text-uppercase">Thông tin liên hệ</h2>
          </div>
        </div>
        <center>
        <div>
          <div class="col-sm-4">
            <div class="team-member">
              <img class="mx-auto rounded-circle" src="static/theme/img/me.jpg" alt="">
              <h4 style="color: white">Lê Nguyễn Chánh Tín</h4>
              <p class="text-muted">D14CQMT01 - N14DCCN112</p>
            </div>
          </div>
        </div>
      </center>
        <div class="row">
          <div class="col-lg-8 mx-auto text-center">
            <p class="large text-muted">Đây là trang web hiển thị thông số môi trường được lấy từ cảm biến</p>
          </div>
        </div>
      </div>
    </section>


    <!-- Footer -->
    <footer>
      <div class="container">
        <div>
          <center>
            <span class="copyright">Copyright &copy; Lê Nguyễn Chánh Tín</span>
        </center>
        </div>
      </div>
    </footer>
    <!-- Bootstrap core JavaScript -->
    <script src="/static/theme/vendor/jquery/jquery.min.js"></script>
    <script src="/static/theme/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

    <!-- Plugin JavaScript -->
    <script src="/static/theme/vendor/jquery-easing/jquery.easing.min.js"></script>

    <!-- Contact form JavaScript -->
    <script src="/static/theme/js/jqBootstrapValidation.js"></script>
    <script src="/static/theme/js/contact_me.js"></script>

    <!-- Custom scripts for this template -->
    <script src="/static/theme/js/agency.min.js"></script>
  </body>
  <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
  <script>
    //Khai báo kết nối Firebase
    var config = {
      apiKey : "AIzaSyCT6xAvB7A60QTRR6GCIGrdPp3Blxh1nsM",
      authDomain : "canhbaochay.firebaseapp.com",
      databaseURL : "https://canhbaochay.firebaseio.com",
      projectId : "canhbaochay",
      storageBucket : "canhbaochay.appspot.com",
      messagingSenderId : "26099383258"
    };
    firebase.initializeApp(config);

    //Kết nối CSDL Firebase
    dataRef = firebase.database().ref();
    dataRef.on('value', function(snapshot) {
      //khai báo biến để lấy thông số
      var nhietdo = snapshot.val().nhietdo;
      var doam = snapshot.val().doam;
      var gas = snapshot.val().gas;
      var CO = snapshot.val().CO;
      var khoi = snapshot.val().khoi;

      //hiển thị thông số
      $('#kqnd').text(nhietdo);
      $('#kqda').text(doam);
      $('#kh').text(gas);
      $('#CO').text(CO);
      $('#khoi').text(khoi);
      var temp = parseFloat(nhietdo);
      var humdr = parseFloat(doam);
      var khigas = parseFloat(gas);
      var khiCO = parseFloat(CO);
      var smoke = parseFloat(khoi);
      if (temp > 36 && smoke >= 10 && khiCO >= 10 || temp >50) {
        tinhtrang = "Cháy";
        $('#tita').text(tinhtrang).css({"color": "red"});
        $('#thongso').css({"color":"red"});
      }
      else if (temp >= 36 && temp <= 50) {
        tinhtrang = "Nhiệt độ tăng cao";
        $('#tita').text(tinhtrang).css({"color": "orange"});
        $('#kqnd').css({"color":"orange"});
      }
      else if (humdr >= 95) {
        tinhtrang = "Độ ẩm lớn";
        $('#tita').text(tinhtrang).css({"color": "blue"});
        $('#kqda').css({"color":"blue"});

      }
      else if (khigas >= 15 && khiCO >= 20) {
        tinhtrang = "Rò rỉ khí gas";
        $('#tita').text(tinhtrang).css({"color": "#444444"});
        $('#kh').css({"color":"#444444"});
      }
      else {
        tinhtrang = "Bình thường";
        $('#tita').text(tinhtrang).css({"color": "green"});
      }
    });
  </script>
</html>
